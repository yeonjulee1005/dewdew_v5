# Dewdew Portfolio v5 - Cursor Rules

## 프로젝트 개요
이 프로젝트는 Nuxt 4 기반의 포트폴리오 웹사이트로, AI 채팅 기능을 포함한 풀스택 애플리케이션입니다.

## 기술 스택
- **Framework**: Nuxt 4.2.1 (Vue 3 + SSR)
- **Language**: TypeScript 5.6.3
- **Styling**: Sass + Tailwind CSS + Nuxt UI (커스텀 프리픽스: `Dd`)
- **State Management**: Pinia
- **Backend**: Supabase (PostgreSQL + Edge Functions)
- **AI**: OpenAI API (RAG 기반)
- **Package Manager**: Bun

## 아키텍처 원칙

### 1. 컴포넌트 구조 (Atomic Design)
- `app/components/a/`: Atomic 컴포넌트 (재사용 가능한 기본 컴포넌트)
- `app/components/chat/`: AI 채팅 관련 컴포넌트
- `app/components/intro/`: 인트로 애니메이션 컴포넌트
- `.client.vue` / `.server.vue` 접미사로 클라이언트/서버 컴포넌트 명시

### 2. Composable 패턴
- 도메인별로 분리된 Composable 구조 유지
- 단일 책임 원칙 준수
- `use` 접두사 사용 (예: `useChat`, `useFormatter`)

### 3. 타입 시스템
- 도메인별 타입 파일 분리 (`app/types/`)
- Supabase 타입은 자동 생성 (`bun run supabase:type`)
- 제네릭 타입 활용으로 재사용성 향상

### 4. 스타일링 규칙
- Nuxt UI 컴포넌트는 `Dd` 프리픽스 사용 (예: `DdButton`, `DdChatMessages`)
- Tailwind CSS 유틸리티 클래스 우선 사용
- Sass는 글로벌 스타일 및 폰트에만 사용

## 코딩 컨벤션

### TypeScript
- 엄격한 타입 체크 활성화 (`shim: false`)
- `any` 타입 사용 최소화
- 인터페이스는 도메인별로 분리

### Vue 컴포넌트
- `<script setup lang="ts">` 사용
- Props는 `defineProps<T>()`로 타입 정의
- Emits는 `defineEmits<T>()`로 타입 정의
- 컴포넌트명은 PascalCase

### 파일 명명 규칙
- 컴포넌트: PascalCase (예: `Content.vue`)
- Composable: camelCase with `use` prefix (예: `useChat.ts`)
- 타입 파일: camelCase (예: `chat.ts`)
- 서버 파일: kebab-case (예: `index.post.ts`)

## AI 채팅 시스템

### 구조
- **클라이언트**: `app/composables/chat/useChat.ts` - 스트리밍 처리
- **서버**: `server/api/chat/index.post.ts` - API 엔드포인트
- **Edge Function**: `supabase/functions/dewdew-rag-portfolio/` - RAG 로직
- **공유 모듈**: `supabase/functions/_shared/` - 재사용 가능한 유틸리티

### 스트리밍 처리
- `ReadableStream` 기반 실시간 스트리밍
- `parseStreamResponse` 함수로 스트림 파싱
- 컴포넌트 타입은 `component-mapper.ts`에서 결정

### 성능 최적화
- 스트리밍 중 DOM 조작 최소화 (스크롤 방해 방지)
- `nextTick` 사용으로 DOM 업데이트 후 처리
- MutationObserver는 스트리밍 중 비활성화

## 상태 관리

### Pinia Stores
- `app/stores/locationWeather.ts`: 위치 및 날씨 상태
- `app/stores/menu.ts`: 메뉴 상태
- `pinia-plugin-persistedstate`로 상태 영속화

## 다국어 지원

### i18n 구조
- `i18n/locales/ko.ts`: 한국어 번역
- `i18n/locales/en.ts`: 영어 번역
- `useI18n()` composable 사용
- 기본 언어: 한국어 (`defaultLocale: 'ko'`)

## API 구조

### 서버 API (`server/api/`)
- RESTful API 패턴 준수
- 파일명으로 HTTP 메서드 명시 (예: `index.post.ts`)
- 타입 안전성 보장

### Supabase Edge Functions
- `supabase/functions/_shared/`: 공유 모듈 (배포 안됨)
- `supabase/functions/dewdew-rag-portfolio/`: 배포되는 함수
- TypeScript로 작성

## 성능 최적화

### 이미지
- `@nuxt/image` 사용으로 자동 최적화
- WebP/AVIF 포맷 지원
- Lazy loading 적용

### 번들 최적화
- Tree shaking 활성화
- Dynamic import 사용
- 코드 스플리팅

### 스크롤 최적화
- `flex-1 min-h-0` 패턴으로 높이 제한
- `overflow-hidden` / `overflow-y-auto` 적절히 사용
- 스트리밍 중 DOM 조작 최소화

## 에러 처리

### 클라이언트
- `app/error.vue`: 전역 에러 페이지
- `app/components/chat/Error.vue`: 채팅 에러 컴포넌트
- Try-catch로 에러 핸들링

### 서버
- Supabase Edge Functions에서 에러 응답 처리
- 적절한 HTTP 상태 코드 반환

## 개발 워크플로우

### 환경 변수
- `.env` 파일에 필수 변수 설정
- `SUPABASE_URL`, `SUPABASE_KEY` 필수
- `OPENAI_API_KEY` (AI 채팅 기능용)

### 빌드 및 배포
- 개발: `bun dev` (포트: 4110)
- 빌드: `bun build`
- Supabase Functions 배포: `bun run supabase:deploy`

### 버전 관리
- `scripts/version-manager.js`로 버전 관리
- `bun run version:patch|minor|major`

## 주의사항

1. **Nuxt UI 프리픽스**: 모든 Nuxt UI 컴포넌트는 `Dd` 프리픽스 사용
2. **서버/클라이언트 컴포넌트**: `.server.vue` / `.client.vue` 접미사 명시
3. **타입 안전성**: `any` 타입 사용 지양, 제네릭 타입 활용
4. **성능**: 스트리밍 중 DOM 조작 최소화
5. **다국어**: 모든 사용자에게 보이는 텍스트는 i18n 사용

## 참고 자료
- [Nuxt 4 문서](https://nuxt.com/)
- [Nuxt UI 문서](https://ui.nuxt.com/)
- [Supabase 문서](https://supabase.com/docs)
- [Vue 3 문서](https://vuejs.org/)

